<!--
  Signup-side for Understory værter.
  - Bruges til at oprette en ny vært-konto.
  - HTTP: GET /signup henter denne side (response med HTML).
  - HTTP: POST /signup sender formular-data til serveren i request-body'en.
-->

<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <title>Understory – Opret bruger</title>

    <!--
      Siden ligger i applikationslaget i 5-lagsmodellen.
      Browseren modtager HTML som payload i et HTTP-response og gengiver det.
    -->

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   
    <!-- Ekstra styling kun til signup-siden (laver vi bagefter i signup.css) -->
    <link rel="stylesheet" href="/signup.css" />
  </head>

  <body>
    <!-- HEADER / TOPBAR – kopieret fra forsiden/login, så look & feel er ens -->
    <header class="topbar">
      <div class="topbar-inner">
        <a href="/" class="logo">
          <span class="logo-mark">U</span>
          <span class="logo-text">Understory</span>
        </a>
        <nav class="topbar-nav">
          <a href="/" class="topbar-link">Forside</a>
          <a href="/login" class="topbar-link">Log ind</a>
        </nav>
      </div>
    </header>

    <!--
      MAIN: Signup-card midt på siden.
      Flow:
      1) Klient laver GET /signup → denne HTML-side sendes.
      2) Bruger udfylder formular.
      3) Klik på "Opret konto" → browser laver POST /signup med form-data.
    -->
    <main class="auth-main">
      <section class="auth-card" aria-labelledby="signup-title">
        <h1 id="signup-title" class="auth-title">Opret vært-konto</h1>

        <p class="auth-intro">
          Opret en konto for at få adgang til værtsforum, samarbejder og dit
          Understory-dashboard.
        </p>

        <!--
          SIGNUP-FORMULAR
          - method="POST": data sendes i HTTP-body'en (form-encoded eller JSON).
          - action="/signup": backend endpoint der opretter brugeren.
          Serveren vil typisk:
            * Validere input.
            * Hash'e password med bcrypt.
            * Gemme brugeren i database/JSON.
        -->
        <form class="auth-form" method="POST" action="/signup">
          <!-- Navn på vært / profil -->
          <div class="form-group">
            <label for="firstname">Fornavn</label>
            <input type="text" id="firstname" name="firstname" required autocomplete="given-name" placeholder="Dit fornavn" />
          </div>

          <div class="form-group">
            <label for="lastname">Efternavn</label>
            <input type="text" id="lastname" name="lastname" required autocomplete="family-name" placeholder="Dit efternavn" />
          </div>

          <!-- Email bruges som login-identitet -->
          <div class="form-group">
            <label for="email">E-mail</label>
            <input
              type="email"
              id="email"
              name="email"
              required
              autocomplete="email"
              placeholder="din@email.dk"
            />
          </div>

          <!-- Password (klartekst i HTML, men skal hashes på serveren) -->
          <div class="form-group">
            <label for="password">Adgangskode</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              autocomplete="new-password"
              placeholder="Vælg en adgangskode"
            />
          </div>

          <!-- Gentag password for simpel validering -->
          <div class="form-group">
            <label for="confirmPassword">Gentag adgangskode</label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              required
              autocomplete="new-password"
              placeholder="Gentag adgangskoden"
            />
            <!--
              På serversiden kan vi:
              - Tjekke at password === confirmPassword.
              - Afvise request med passende HTTP-statuskode (400 Bad Request)
                hvis det ikke stemmer.
            -->
          </div>

          <div class="form-group">
            <label for="phone">Telefonnummer</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              required
              inputmode="tel"
              placeholder="+45 12 34 56 78"
            />
          </div>

          <div class="form-group">
            <label for="birthdate">Fødselsdato</label>
            <input type="date" id="birthdate" name="birthdate" required />
          </div>

          <div class="form-group">
            <label for="city">By</label>
            <input type="text" id="city" name="city" required placeholder="København" />
          </div>

          <div class="form-group">
            <label for="bio">Biografi</label>
            <textarea id="bio" name="bio" rows="3" placeholder="Fortæl lidt om dig selv"></textarea>
          </div>

          <div class="form-group">
            <label for="is_company">Er du en virksomhed?</label>
            <select id="is_company" name="is_company" required>
              <option value="0">Nej</option>
              <option value="1">Ja</option>
            </select>
          </div>

          <div class="form-group" id="cvr-group" style="display:none;">
            <label for="cvr">CVR-nummer (kun hvis virksomhed)</label>
            <input type="text" id="cvr" name="cvr" placeholder="12345678" />
          </div>

          <div class="form-group">
            <label for="open_for_collab">Er du åben for samarbejde?</label>
            <select id="open_for_collab" name="open_for_collab" required>
              <option value="1">Ja</option>
              <option value="0">Nej</option>
            </select>
          </div>

          <!-- Område til server-genererede fejlbeskeder -->
          <p class="auth-error-message">
            <!-- Her kan serveren indsætte fx: "Email er allerede i brug" -->
          </p>

          <!--
            Submit-knappen sender POST /signup.
            Ved succes kan backend:
              - Oprette brugeren.
              - Hash'e password.
              - Oprette session/cookie.
              - Sende 302 Redirect til /dashboard.
          -->
          <button type="submit" class="btn btn-primary auth-submit">
            Opret konto
          </button>
        </form>

        <!-- Link til login for eksisterende brugere -->
        <p class="auth-footer-text">
          Har du allerede en konto?
          <a href="/login" class="auth-link">Log ind</a>
        </p>

        <!--
          SIKKERHED (til eksamenssnak):
          - HTML'en her er ikke sikkerhed i sig selv.
          - Beskyttelse sker via:
            * HTTPS (TLS) → krypterer trafikken, så password ikke er i klartekst på nettet.
            * Hashing (bcrypt) på serversiden.
            * Korrekt håndtering af session-cookies (HttpOnly, Secure, SameSite).
        -->
      </section>
    </main>

    <!-- Footer (samme stil som forsiden) -->
    <footer class="site-footer">
      <div class="site-footer-inner">
        <p>&copy; Understory – Værtsforum og oplevelsesøkonomi</p>
      </div>
    </footer>
    <script>
      // Show/hide CVR based on company selection
      const companySelect = document.getElementById('is_company');
      const cvrGroup = document.getElementById('cvr-group');

      companySelect.addEventListener('change', function () {
        if (this.value === '1') {
          cvrGroup.style.display = 'block';
          document.getElementById('cvr').required = true;
        } else {
          cvrGroup.style.display = 'none';
          document.getElementById('cvr').required = false;
        }
      });

      // Password validation rules
      const passwordInput = document.getElementById('password');
      const confirmInput = document.getElementById('confirmPassword');
      const countryCodeSelect = document.getElementById('countryCode');
      const phoneInput = document.getElementById('phoneNumber');
      const phoneHidden = document.getElementById('phone');
      const form = document.querySelector('.auth-form');
      const errorBox = document.querySelector('.auth-error-message');

      form.addEventListener('submit', function (e) {
        const countryCode = (countryCodeSelect.value || '').trim();
        const phoneDigits = (phoneInput.value || '').replace(/\\D/g, '');
        const countryDigits = countryCode.replace(/\\D/g, '');
        const combinedDigits = countryDigits + phoneDigits;

        if (!countryCode) {
          e.preventDefault();
          errorBox.textContent = "V\u00e6lg en landekode for dit telefonnummer.";
          return;
        }

        if (combinedDigits.length < 10) {
          e.preventDefault();
          errorBox.textContent = "Telefonnummer skal inkludere landekode og have mindst 10 cifre (fx +4512345678).";
          return;
        }

        phoneHidden.value = `+${combinedDigits}`;

        const password = passwordInput.value;
        const confirm = confirmInput.value;

        const hasMinLength = password.length >= 8;
        const hasUppercase = /[A-Z]/.test(password);
        const hasNumber = /\d/.test(password);

        if (!hasMinLength || !hasUppercase || !hasNumber) {
          e.preventDefault();
          errorBox.textContent = "Adgangskoden skal være mindst 8 tegn og indeholde 1 stort bogstav og 1 tal.";
          return;
        }

        if (password !== confirm) {
          e.preventDefault();
          errorBox.textContent = "Adgangskoderne skal være ens.";
          return;
        }
      });
    </script>
  </body>
</html>
